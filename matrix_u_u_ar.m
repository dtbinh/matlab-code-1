syms b l d;
syms b11 b12 b13 b14 b21 b22 b23 b24 b31 b32 b33 b34 b41 b42 b43 b44;
syms m Ix Iy Iz;

%変換行列作成
P = diag([b b*l b*l d])
Q = [1 1 1 1;
    1 -1 -1 1;
    1 1 -1 -1;
    -1 1 -1 1]
R = [b11 b12 b13 b14;
    b21 b22 b23 b24;
    b31 b32 b33 b34;
    b41 b42 b43 b44
    ]

X = Q*R
S = P*Q*R

B = [0 0 0 0;
    0 0 0 0;
    0 0 0 0;
    0 0 0 0;
    0 0 0 0;
    1/m 0 0 0;
    0 0 0 0;
    0 0 0 0;
    0 0 0 0;
    0 1/Ix 0 0;
    0 0 1/Iy 0;
    0 0 0 1/Iz
    ]

B_ar = B*S
B_ar = simplify(B_ar)

%---------------------------------------------------------
% result
%---------------------------------------------------------
% B_ar =
% [                                          0,                                          0,                                          0,                                          0]
% [                                          0,                                          0,                                          0,                                          0]
% [                                          0,                                          0,                                          0,                                          0]
% [                                          0,                                          0,                                          0,                                          0]
% [                                          0,                                          0,                                          0,                                          0]
% [          (b*b11 + b*b21 + b*b31 + b*b41)/m,          (b*b12 + b*b22 + b*b32 + b*b42)/m,          (b*b13 + b*b23 + b*b33 + b*b43)/m,          (b*b14 + b*b24 + b*b34 + b*b44)/m]
% [                                          0,                                          0,                                          0,                                          0]
% [                                          0,                                          0,                                          0,                                          0]
% [                                          0,                                          0,                                          0,                                          0]
% [ (b*b11*l - b*b21*l - b*b31*l + b*b41*l)/Ix, (b*b12*l - b*b22*l - b*b32*l + b*b42*l)/Ix, (b*b13*l - b*b23*l - b*b33*l + b*b43*l)/Ix, (b*b14*l - b*b24*l - b*b34*l + b*b44*l)/Ix]
% [ (b*b11*l + b*b21*l - b*b31*l - b*b41*l)/Iy, (b*b12*l + b*b22*l - b*b32*l - b*b42*l)/Iy, (b*b13*l + b*b23*l - b*b33*l - b*b43*l)/Iy, (b*b14*l + b*b24*l - b*b34*l - b*b44*l)/Iy]
% [        -(b11*d - b21*d + b31*d - b41*d)/Iz,        -(b12*d - b22*d + b32*d - b42*d)/Iz,        -(b13*d - b23*d + b33*d - b43*d)/Iz,        -(b14*d - b24*d + b34*d - b44*d)/Iz]
 
%---------------------------------------------------------
% result(simplify)
%---------------------------------------------------------
% B_ar =
% [                                0,                                0,                                0,                                0]
% [                                0,                                0,                                0,                                0]
% [                                0,                                0,                                0,                                0]
% [                                0,                                0,                                0,                                0]
% [                                0,                                0,                                0,                                0]
% [    (b*(b11 + b21 + b31 + b41))/m,    (b*(b12 + b22 + b32 + b42))/m,    (b*(b13 + b23 + b33 + b43))/m,    (b*(b14 + b24 + b34 + b44))/m]
% [                                0,                                0,                                0,                                0]
% [                                0,                                0,                                0,                                0]
% [                                0,                                0,                                0,                                0]
% [ (b*l*(b11 - b21 - b31 + b41))/Ix, (b*l*(b12 - b22 - b32 + b42))/Ix, (b*l*(b13 - b23 - b33 + b43))/Ix, (b*l*(b14 - b24 - b34 + b44))/Ix]
% [ (b*l*(b11 + b21 - b31 - b41))/Iy, (b*l*(b12 + b22 - b32 - b42))/Iy, (b*l*(b13 + b23 - b33 - b43))/Iy, (b*l*(b14 + b24 - b34 - b44))/Iy]
% [  -(d*(b11 - b21 + b31 - b41))/Iz,  -(d*(b12 - b22 + b32 - b42))/Iz,  -(d*(b13 - b23 + b33 - b43))/Iz,  -(d*(b14 - b24 + b34 - b44))/Iz]
 
